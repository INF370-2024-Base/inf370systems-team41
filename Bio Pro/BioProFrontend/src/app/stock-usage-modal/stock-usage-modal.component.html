<h2 mat-dialog-title>Stock Inventory Management Dashboard</h2>
<div mat-dialog-content>
  <div class="modal-dashboard">

    <!-- Week Picker for Weekly Selection -->
    <div class="week-picker">
      <label for="weekDate">Select Week:</label>
      <input type="week" id="weekDate" [(ngModel)]="selectedWeek" (change)="changeWeek(selectedWeek)">
    </div>

    <!-- Chart Section -->
    <div class="chart-container">
      <h2 class="chart-heading">Weekly Stock Usage</h2>
      <canvas #stockUsageChart></canvas>
    </div>

    <div class="chart-container">
      <h2 class="chart-heading">Stock Levels vs Minimum Stock Levels</h2>
      <canvas #stockLevelChart></canvas>
    </div>

    <!-- KPIs Section -->
    <div class="dashboard-summary">
      <div class="kpi">
        <h3>Total Stock Items</h3>
        <p>{{ filteredStock.length }}</p>
      </div>
      <div class="kpi">
        <h3>Items Below Minimum Level</h3>
        <p>{{ belowMinStock.length }}</p>
      </div>
      <div class="kpi">
        <h3>Weeks of Stock Data</h3>
        <p>{{ weeklyStockUsage.length }}</p>
      </div>
    </div>

    <!-- Weekly Stock Usage Details -->
    <div class="stock-usage-details">
      <h3>Weekly Stock Usage Details</h3>
      <div *ngIf="weeklyStockUsage.length > 0">
        <div *ngFor="let weekData of weeklyStockUsage" class="week-card">
          <h4>Week {{ weekData.week }}</h4>
          <p>Total Usage: {{ weekData.totalUsage }} units</p>
          <ul>
            <li *ngFor="let detail of weekData.stockDetails">
              {{ detail.stockName }}: {{ detail.Quantity }} used on {{ detail.DateUsed | date: 'MMM d, y' }}
            </li>
          </ul>
        </div>
      </div>
      <p *ngIf="weeklyStockUsage.length === 0">No stock usage data available for the selected week.</p>
    </div>

    <!-- Stock Items Below Minimum Level -->
    <div class="below-minimum-level">
      <h3>Stock Items Below Minimum Level</h3>
      <ul *ngIf="belowMinStock.length > 0">
        <li *ngFor="let stock of belowMinStock">
          {{ stock.stockName }} ({{ stock.quantityAvailable }} units left, minimum required: {{ stock.minimumStockLevel }})
        </li>
      </ul>
      <p *ngIf="belowMinStock.length === 0">All stock items are above the minimum level.</p>
    </div>
  </div>

  <div mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Close</button>
  </div>
</div>
