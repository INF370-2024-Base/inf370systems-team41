<h2 mat-dialog-title>Stock Inventory Management Dashboard</h2>
<div mat-dialog-content>
  <div class="modal-dashboard">
    <!-- Week Picker for Weekly Selection -->
    <mat-form-field appearance="fill" class="week-picker">
      <mat-label>Select Week</mat-label>
      <input matInput type="week" [(ngModel)]="selectedWeek" (change)="changeWeek(selectedWeek)">
    </mat-form-field>

    <!-- KPIs Section -->
    <div class="dashboard-summary">
      <div class="kpi">
        <h4>Total Stock Items</h4>
        <p>{{ filteredStock.length }}</p>
      </div>
      <div class="kpi">
        <h4>Weeks of Stock Data</h4>
        <p>{{ weeklyStockUsage.length }}</p>
      </div>
      <div class="kpi">
        <h4>Items Below Minimum Level</h4>
        <p>{{ belowMinStock.length }}</p>
      </div>
    </div>

     <!-- Weekly Stock Usage Details -->
    <mat-card class="stock-usage-details">
      <mat-card-title>Weekly Stock Usage Details</mat-card-title>
      <mat-divider></mat-divider>
      <mat-card-content>
        <div *ngIf="weeklyStockUsage.length > 0">
          <div *ngFor="let weekData of weeklyStockUsage" class="week-card">
            <h6>Week {{ weekData.week }}</h6>
            <p>Total Usage: {{ weekData.totalUsage }} units</p>
            <ul>
              <li *ngFor="let detail of weekData.stockDetails">
                {{ detail.stockName }}: {{ detail.quantity }} used on {{ detail.dateUsed | date: 'MMM d, y' }}
              </li>
            </ul>
          </div>
        </div>
        <p *ngIf="weeklyStockUsage.length === 0">No stock usage data available for the selected week.</p>
      </mat-card-content>
    </mat-card>
 <!-- Stock Usage Chart Section -->
 <mat-card class="chart-container">
  <mat-card-title>Weekly Stock Usage Chart</mat-card-title>
  <mat-divider></mat-divider>
  <mat-card-content>
    <canvas #uniqueStockUsageChart id="uniqueStockUsageChart"></canvas>
  </mat-card-content>
</mat-card>

    <!-- Quarterly Gauges Section -->
    <div class="quarterly-gauge-container">
      <h5>Quarterly Total Stock Use</h5>
      <div class="gauge-row">
        <div class="gauge">
          <h6>Q1</h6>
          <canvas #quarter1Gauge></canvas>
          <p>Total: {{ quarterlyUsage[0] }} units</p> <!-- Display Q1 total -->
        </div>
        <div class="gauge">
          <h6>Q2</h6>
          <canvas #quarter2Gauge></canvas>
          <p>Total: {{ quarterlyUsage[1] }} units</p> <!-- Display Q2 total -->
        </div>
      </div>
      <div class="gauge-row">
        <div class="gauge">
          <h6>Q3</h6>
          <canvas #quarter3Gauge></canvas>
          <p>Total: {{ quarterlyUsage[2] }} units</p> <!-- Display Q3 total -->
        </div>
        <div class="gauge">
          <h6>Q4</h6>
          <canvas #quarter4Gauge></canvas>
          <p>Total: {{ quarterlyUsage[3] }} units</p> <!-- Display Q4 total -->
        </div>
      </div>
      <div class="gauge-total">
        <h6>Total Stock Used</h6>
        <p>{{ totalStockUsed }} units</p> <!-- Updated to use the getter -->
      </div>
    </div>

    <mat-card class="chart-container">
      <mat-card-title>Stock Levels vs Minimum Stock Levels</mat-card-title>
      <mat-divider></mat-divider>
      <mat-card-content>
        <canvas #stockLevelChart></canvas>
      </mat-card-content>
    </mat-card>
  </div>

  <div mat-dialog-actions align="end">
    <button mat-raised-button color="primary" mat-dialog-close>Close</button>
  </div>
</div>
