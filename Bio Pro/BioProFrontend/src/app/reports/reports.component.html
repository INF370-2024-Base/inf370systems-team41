<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reports</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
 
</head>
<body>
  <h1 style="font-size: 48px; color: #333; text-align: center; text-transform: uppercase; letter-spacing: 3px; margin-bottom: 20px;">
    REPORTS
  </h1> 
  <div class="header-container" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <!-- Filter on the left side -->
    <div class="filter-container" style="flex-grow: -1;">
      <mat-form-field appearance="fill" style="width: 200px;">
        <mat-label style="font-size: 12px; color: grey;">Filter By</mat-label>
        <mat-select [(ngModel)]="selectedReport" (selectionChange)="filterReports($event.value)">
          <mat-option value="all">All Reports</mat-option>
          <mat-option value="allOrdersReport">All Orders Report</mat-option>
          <mat-option value="orderTypesReport">Types of Orders Totals Report</mat-option>
          <mat-option value="DentistReport">List of All Dentists Report</mat-option>
          <mat-option value="EmployeeReport">List of All Employees Report</mat-option>
          <mat-option value="stockWriteOffsReport">Overall Stock Write-Offs Report</mat-option>
          <mat-option value="deliveryReport">Deliveries Report</mat-option>
          <mat-option value="employeeHoursReport">Employee Hours Report</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    
  
    <!-- Report date and logged-in user on the right side -->
    <div class="report-info-container" style="text-align: right; color: #404040; font-size: 12px;">
      <div class="report-date">
        Reports generated on: {{ formatDate(currentDate) }}
      </div>
      <p>
        Logged-in User: <span style="font-weight: bold;">{{ loggedInUserName }}</span>
      </p>
    </div>
  </div>
  

  
  <div class="reports-container">
    <div class="report-section" id="allOrdersReport">
      <h2>All Orders Report</h2>
      <table>
        <thead>
          <tr>
            <th (click)="onSortChange('orderId')">Order ID</th>
            <th (click)="onSortChange('dentistId')">Dentist ID</th>
            <th (click)="onSortChange('priorityLevel')">Priority Level <span>{{ sortColumn === 'priorityLevel' ? (sortDirection === 'asc' ? '▲' : '▼') : '▲▼' }}</span></th>
            <th (click)="onSortChange('dueDate')">Order Date <span>{{ sortColumn === 'dueDate' ? (sortDirection === 'asc' ? '▲' : '▼') : '▲▼' }}</span></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of orders">
            <td>{{ order.orderId }}</td>
            <td>{{ order.dentistId }}</td>
            <td>{{ order.priorityLevel }}</td>
            <td>{{ order.dueDate | date:'yyyy-MM-dd' }}</td>
          </tr>
        </tbody>
      </table>
      <button class="download-button" (click)="downloadPDF('All Orders Report', 'allOrdersReport')">Download PDF</button>
    </div>

    <div class="report-section" id="orderTypesReport">
      <h2> Types of Orders Totals Report</h2>
      <table>
        <thead>
          <tr>
            <th>Order Type</th>
            <th>Order Count</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let orderType of orderTypeWithCount">
            <td>{{ orderType.description }}</td>
            <td>{{ orderType.orderCount }}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td><strong>Total</strong></td>
            <td><strong>{{ totalOrderCount }}</strong></td>
          </tr>
        </tfoot>
      </table>
      <button class="download-button" (click)="downloadPDF('Types of Orders Totals Report', 'orderTypesReport')">Download PDF</button>
    </div>

    <!-- <div class="report-section" id="stockTypesReport">
      <h2>Stock Types Count By Category Report</h2>
      <table>
        <thead>
          <tr>
            <th>Stock Type</th>
            <th>Type Category Count</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let stockType of stockTypes">
            <td>{{ stockType.description }}</td>
            <td>{{ stockType.stockCategoriesCount }}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td><strong>Total</strong></td>
            <td><strong>{{  totalTypeCategoryCount }}</strong></td>
          </tr>
        </tfoot>
      </table>
      <button class="download-button" (click)="downloadPDF('Stock Types Report', 'stockTypesReport')">Download PDF</button>
    </div> -->

   <div class="report-section" id="DentistReport">
  <h1>List of All Dentists Report</h1>
  
  <table mat-table [dataSource]="dentists" class="mat-elevation-z8" style="width: 100%;">
    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef style="width: 20%;"> Name </th>
      <td mat-cell *matCellDef="let dentist" style="word-wrap: break-word; width: 20%;"> 
        {{dentist.firstName}} {{dentist.lastName}} 
      </td>
    </ng-container>
    
    <!-- Contact Details Column -->
    <ng-container matColumnDef="contact">
      <th mat-header-cell *matHeaderCellDef style="width: 30%;"> Contact Details </th>
      <td mat-cell *matCellDef="let dentist" style="word-wrap: break-word; width: 30%;"> 
        {{dentist.contactDetail}} 
      </td>
    </ng-container>
    
    <!-- Address Column -->
    <ng-container matColumnDef="address">
      <th mat-header-cell *matHeaderCellDef style="width: 50%;"> Address </th>
      <td mat-cell *matCellDef="let dentist" style="word-wrap: break-word; width: 50%;"> 
        {{dentist.address}} 
      </td>
    </ng-container>
    
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
  
  <div class="total-count">
    <p><strong>Total Number of Dentists: {{totalDentists}}</strong></p>
  </div>
  <button class="download-button" (click)="downloadPDF('List of All Dentists Report', 'dentistReport')">Download PDF</button>
</div>

<div class="report-section" id="EmployeeReport">
  <h1>List of All Employees Report</h1>
  
  <table mat-table [dataSource]="employee" class="mat-elevation-z8" style="width: 100%;">
    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef style="width: 20%;"> Name </th>
      <td mat-cell *matCellDef="let employee" style="word-wrap: break-word; width: 20%;"> 
        {{employee.firstName}} {{employee.lastName}} 
      </td>
    </ng-container>
    
    <!-- Contact Details Column -->
    <ng-container matColumnDef="contact">
      <th mat-header-cell *matHeaderCellDef style="width: 30%;"> Phone Number </th>
      <td mat-cell *matCellDef="let employee" style="word-wrap: break-word; width: 30%;"> 
        {{employee.cellphoneNumber}} 
      </td>
    </ng-container>
    
    <!-- Address Column -->
    <ng-container matColumnDef="address">
      <th mat-header-cell *matHeaderCellDef style="width: 50%;"> Address </th>
      <td mat-cell *matCellDef="let employee" style="word-wrap: break-word; width: 50%;"> 
        {{employee.address}} 
      </td>
    </ng-container>
    
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
  
  <div class="total-count">
    <p><strong>Total Number of Employees: {{totalEmployees}}</strong></p>
  </div>
  <button class="download-button" (click)="downloadPDF('List of All Employees Report', 'employeeReport')">Download PDF</button>
</div>

    
     <!-- <div class="report-section" id="stockItemsReport">
      <h2>Stock Items Count By Category Report</h2>
      <table>
        <thead>
          <tr>
            <th>Stock Category</th>
            <th>Stock Item Count</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let stockItem of stockItems">
            <td>{{ stockItem.description }}</td>
            <td>{{ stockItem.stockItemsCount }}</td>
          </tr>
        </tbody>
      </table>
      <button class="download-button" (click)="downloadPDF('Stock Items Report', 'stockItemsReport')">Download PDF</button>
    </div> -->

   <div class="report-section" id="stockWriteOffsReport">
    <h2>Overall Stock Write-Offs Report</h2>
    <table>
      <thead>
        <tr>
          <th>Stock Name</th>
          <th>Quantity Written Off</th>
          <th>Write-Off Date</th>
          <th>Reason</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let writeOff of stockWriteOffs">
          <td>{{ writeOff.stockName }}</td>
          <td>{{ writeOff.quantityWrittenOff }}</td>
          <td>{{ writeOff.writtenOffDate | date:'yyyy-MM-dd' }}</td>
          <td>{{ writeOff.reason }}</td>
        </tr>
      </tbody>
    </table>
    <div>
      <strong>Total Quantity Written Off (Overall):</strong> {{ totalQuantityWrittenOff }}
    </div>
      <button class="download-button" (click)="downloadPDF('Overall Stock Write-Offs Report', 'stockWriteOffsReport')">Download PDF</button>
    </div> 
    
    

    <div class="report-section" id="deliveryReport">
      <h2>Deliveries Report</h2>
      <div class="main-container">
        <div class="report-summary">
          <mat-card class="summary-card">
            <mat-card-header>
              <mat-card-title>Total Deliveries Captured</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p>{{ totalDeliveries }}</p>
            </mat-card-content>
          </mat-card>
          <mat-card class="summary-card">
            <mat-card-header>
              <mat-card-title>Deliveries by Status Totals</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-list>
                <mat-list-item *ngFor="let status of deliveryStatuses" style="display: flex; justify-content: space-between; align-items: center;">
                  <span style="flex: 1; margin-right: 16px; font-weight: bold;">{{ status.name }}</span>
                  <span>{{ status.count }}</span>
                </mat-list-item>
              </mat-list>
              
             
            </mat-card-content>
          </mat-card>
          <mat-card class="summary-card">
            <mat-card-header>
              <mat-card-title>Recent Deliveries</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-list>
                <mat-list-item *ngFor="let delivery of recentDeliveries">
                  <h4 matLine  style="flex: 1; margin-right: 16px; font-weight: bold;">Order ID: {{ delivery.systemOrderId }}</h4>         
                  <p matLine>Status: {{ delivery.deliveryStatus?.status }}</p>
                </mat-list-item>
              </mat-list>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      <button class="download-button" (click)="downloadPDF('Deliveries Report', 'deliveryReport')">Download PDF</button>
    </div>

    <div class="report-section" id="employeeHoursReport">
      <h2>Employee Hours Report</h2>
      <select [(ngModel)]="selectedPeriod" (change)="updateChart()">
        <option value="monthly">Monthly Hours</option>
        <option value="weekly">Weekly Hours</option>
      </select>
      <canvas id="canvas"></canvas>
      <button class="download-button" (click)="downloadPDF('Employee Hours Report', 'employeeHoursReport')">Download PDF</button>
    </div>
 
  </div>
</body>
</html>
